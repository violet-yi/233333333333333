# yaml锚点(不懂自行Google)勿动
proxy-provider-http: &http
  type: http
  interval: 1800
  health-check:
    enable: true
    url: http://www.youtube.com/generate_204
    interval: 15

proxy-provider-file: &file
  type: file
  health-check:
    enable: false
    url: http://www.youtube.com/generate_204
    interval: 7200

# Clash配置
mixed-port: 7890
allow-lan: false
mode: rule
log-level: info
ipv6: false

external-controller: 127.0.0.1:9090
# 控制面板相对路径
# external-ui: folder

dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:1053
  default-nameserver:
   - 223.5.5.5
   - 119.29.29.29
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver: 
    - 'https://doh.pub/dns-query'
    - 'https://223.5.5.5/dns-query'
  fallback:
    - 'https://doh.dns.sb/dns-query'
    - 'https://1.1.1.1/dns-query'
    - 'tls://8.8.4.4:853'
  fallback-filter:
    geoip: true
    geoip-code: CN

# 如果有节点可按文档填写，并在group内使用
proxies:
  # - name: "ss1"
  #   type: ss
  #   server: server
  #   port: 443
  #   cipher: chacha20-ietf-poly1305
  #   password: "password"
  #   # udp: true

# 策略组示例
      # - name: 分组名
        # type: select       # 手动选点   
        # url-test     # 自动选择延迟最低的节点
        # fallback     # 节点故障时自动切换下一个
        # laod-balance # 均衡使用分组内的节点
        # url: http://www.youtube.com/generate_204 # 测试地址 非select类型分组必要
        # interval: 300 # 自动测试间隔时间，单位秒 非select类型分组必要
        # tolerance: 50 # 允许的偏差，节点之间延迟差小于该值不切换 非必要
        # proxies:  
          # - 节点名称或其他分组套娃
proxy-groups:
  - name: 🚀 节点选择
    type: select
    # proxies引用别的组或者配置在文件内proxies的节点
    proxies:
      - ♻️ 自动选择
      - 🇭🇰 香港节点
      - 🇨🇳 台湾节点
      - 🇸🇬 狮城节点
      - 🇯🇵 日本节点
      - 🚀 手动切换
      # 如有配置proxies部分可按如下格式使用配置文件内自定义的节点(非订阅节点)
      # - ss1

  - name: 🚀 手动切换
    type: select
    use:
      - Sub1
    filter: "(香港|日本|新加坡|台湾)0[134]"

  - name: 🎨 Telegram
    type: select
    use:
      - Sub1
    proxies:
      - 🚀 节点选择
    filter: "(香港|日本|新加坡|台湾)0[567]"
    
  - name: 💐 Live
    type: select
    proxies:
      - 🚀 节点选择
      - 🇨🇳 台湾节点
      - 🇯🇵 日本节点
      
  - name: 🎀 Medium
    type: select
    proxies:
      - 🚀 节点选择
      - 🇭🇰 香港节点
      - 🇸🇬 狮城节点
      
  - name: 🍮 YouTube
    type: select
    proxies:
      - 🚀 节点选择
      
  - name: 🍭 Play下载
    type: select
    proxies:
      - 🇸🇬 狮城节点
      - 🇯🇵 日本节点
      - 🚀 手动切换

  - name: ♻️ 自动选择
    type: url-test
    url: http://www.youtube.com/generate_204
    # interval: 5
    tolerance: 100
    use:
      - Sub1
    filter: "香港|日本"

  - name: 🇭🇰 香港节点
    type: url-test
    url: http://www.youtube.com/generate_204
    # interval: 5
    tolerance: 100
    use:
      - Sub1
      # 当proxy-provider配置多个订阅时，使用use下方格式引用，这里为只有一个订阅的情况
      # - Sub2
      # - Sub3
    # filter使用正则表达式去筛选节点
    filter: "香港"

  - name: 🇸🇬 狮城节点
    type: url-test
    url: http://www.youtube.com/generate_204
    # interval: 5
    tolerance: 100
    use:
      - Sub1
      # - Sub2
      # - Sub3
    filter: "新加坡"

  - name: 🇯🇵 日本节点
    type: url-test
    url: http://www.youtube.com/generate_204
    # interval: 5
    tolerance: 100
    use:
      - Sub1
      # - Sub2
      # - Sub3
    filter: "日本"

  - name: 🇨🇳 台湾节点
    type: url-test
    url: http://www.youtube.com/generate_204
    # interval: 5
    tolerance: 100
    use:
      - Sub1
      # - Sub2
      # - Sub3
    filter: "台"
  
   #正则：(A).*(B)       既有 A 也有 B 
   # .*             包含全部   
   # ^(?!.*A)       不含有 A 
   # ^(?!.*A).*(B)  不含A 有 B
   # ^(?!.*[台湾原生12345]).*(推荐) 排除前者任意一个字符 包含后者
   ## (香港|日本|新加坡)0[2-4]   包含括号内加序号#也可写做[234]
   # 香港0[1-5](?!.*流)(?!.*推)(?!.*G) 包含前者排除后者#香港0[13579]

# proxy-provider 可参考meta内核文档 https://clash-meta.wiki/config/proxy-providers
proxy-providers:
  # 在线订阅,有多个机场按格式书写在下面
  # 报错就在url后加上 &flag=clash
  Sub1:
    <<: *http
    path: ./proxies/Sub1.yaml
    url: https://dingyue.wenlianyun.vip/api/v1/client/subscribe?token=d997d029f869308482d0613b11cb0952&security=a3b7fbbce2345d777&flag=clash

  # 本地节点，路径可填写绝对路径或者相对路径(为clash工作目录下)
  # Sub3:
  #   <<: *file
  #   path: ./proxies/Sub3.yaml

# 可参考meta核文档 https://clash-meta.wiki/config/rules/rule-provider
rule-providers:
  localdirect:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/withered233/Shunt-Rules/main/Local%20Direct.yaml"
    path: ./ruleset/localdirect.yaml
    interval: 86400

  localproxy:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/withered233/Shunt-Rules/main/Local%20Proxy.yaml"
    path: ./ruleset/localproxy.yaml
    interval: 86400

  youtube:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube_No_Resolve.yaml"
    path: ./ruleset/youtube.yaml
    interval: 86400

  ins:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Instagram/Instagram_No_Resolve.yaml"
    path: ./ruleset/ins.yaml
    interval: 86400

  twitter:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter_No_Resolve.yaml"
    path: ./ruleset/twitter.yaml
    interval: 86400

  tiktok:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok_No_Resolve.yaml"
    path: ./ruleset/tiktok.yaml
    interval: 86400

  twitch:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitch/Twitch_No_Resolve.yaml"
    path: ./ruleset/twitch.yaml
    interval: 86400

  telegram:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram_No_Resolve.yaml"
    path: ./ruleset/telegram.yaml
    interval: 86400

  steamcn:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/SteamCN/SteamCN_No_Resolve.yaml"
    path: ./ruleset/steamcn.yaml
    interval: 86400

  proxy:
    type: http
    behavior: domain
    url: "https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400

  direct:
    type: http
    behavior: domain
    url: "https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

  gfw:
    type: http
    behavior: domain
    url: "https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt"
    path: ./ruleset/gfw.yaml
    interval: 86400

  chinaip:
    type: http
    behavior: classical
    url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaIPs/ChinaIPs_Classical_No_Resolve.yaml"
    path: ./ruleset/chinaip.yaml
    interval: 86400

# behavior: classical behavior: ipcidr behavior: domain
# 规则部分建议域名规则在前，ip规则在后
# ip规则尽量使用no-resolve，减少需要走代理的域名在本地解析的情况
rules:
  - RULE-SET,localdirect,DIRECT
  - RULE-SET,localproxy,🚀 节点选择
  - RULE-SET,youtube,🍮 YouTube
  - RULE-SET,ins,🎀 Medium
  - RULE-SET,twitter,🎀 Medium
  - RULE-SET,tiktok,🎀 Medium
  - RULE-SET,twitch,💐 Live
  - DOMAIN-SUFFIX,afreecatv.com,💐 Live
  - DOMAIN-SUFFIX,xn--ngstr-lra8j.com,🍭 Play下载
  - RULE-SET,telegram,🎨 Telegram
  - RULE-SET,steamcn,DIRECT
  - RULE-SET,proxy,🚀 节点选择
  - RULE-SET,direct,DIRECT
  - RULE-SET,gfw,🚀 节点选择
  - RULE-SET,chinaip,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,🚀 节点选择
